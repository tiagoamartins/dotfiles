# General {{{1
run-shell 'tmux set-environment -g TMUX_VERSION $(tmux -V | grep -Eo "[0-9]+([.][0-9]+)?")'

# Set terminal window title
set-option -g set-titles on
set-option -g set-titles-string '#S â€¢ #T'

# Set the default TERM
set-option -g default-terminal tmux

# Update the TERM variable of terminal emulator when creating a new session or attaching a existing session
set-option -g update-environment 'DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY TERM'
# Determine if we should enable 256-color support
if-shell "[[ $TERM =~ 256color || $TERM == fbterm ]]" {
	set-option -g default-terminal tmux-256color
}

# Enable terminal support for BGR 24-bit color
set-option -ga terminal-overrides ',*-256color:Tc'

# Set scrollback history to 30000 (30K)
set-option -g history-limit 30000

# Set Ctrl-a as the default prefix key combination
# and unbind C-b to free it up
set-option -g prefix C-a
unbind-key C-b

# Use send-prefix to pass C-a through to application
bind-key C-a send-prefix

# Enable mouse control
if-shell -b '[ $(echo "$TMUX_VERSION < 2.1" | bc) -eq 1 ]' {
	set-option -g mode-mouse on
	set-option -g mouse-select-window on
	set-option -g mouse-select-pane on
	set-option -g mouse-resize-pane on
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.1" | bc) -eq 1 ]' {
	set-option -g mouse on
}

# Start indices on correct side of keyboard (0 by default)
set-option -g base-index 1
set-window-option -g pane-base-index 1

# Reload ~/.tmux.conf using PREFIX r
bind-key r source-file ~/.tmux.conf\; display-message 'Reloaded!'

# Allow faster command sequences
set-option -s escape-time 0

# Use prefix-'|' to split window horizontally and prefix-'-' to split vertically
bind-key | split-window -h
bind-key - split-window -v

# Use vi-like status and mode keys
set-option -g status-keys vi
set-option -g mode-keys vi

# Map vi-like movement keys as pane movement keys
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Pane resizing
bind-key C-h resize-pane -L 5
bind-key C-j resize-pane -D 5
bind-key C-k resize-pane -U 5
bind-key C-l resize-pane -R 5

# transfer copied text to attached terminal with yank
if-shell -b '[ $(echo "$TMUX_VERSION < 2.4" | bc) -eq 1 ]' {
	bind-key -t vi-copy y copy-pipe "yank > #{pane_tty}"
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.4" | bc) -eq 1 ]' {
	bind-key -T copy-mode-vi y send-keys -X copy-pipe "yank > #{pane_tty}"
}
# transfer most-recently copied text to attached terminal with yank
bind-key -n M-y run-shell 'tmux save-buffer - | yank > #{pane_tty}'
# transfer previously copied text (chosen from a menu) to attached terminal
bind-key -n M-Y choose-buffer 'run-shell "tmux save-buffer -b \"%%%\" - | yank > #{pane_tty}"'
bind-key C-p run 'xclip -out -selection clipboard | tmux load-buffer -; tmux paste-buffer'

# Colors {{{1
color_message_fg=colour208
color_message_bg=colour237
color_pane_border=colour235
color_pane_border_active=colour240
color_status_fg=brightwhite
color_status_bg=black
color_status_window=white
color_status_window_activity=red
color_status_user=colour33
color_status_at=colour136
color_status_host=colour166

# Set pane colors - highlight the active pane
if-shell -b '[ $(echo "$TMUX_VERSION < 2.9" | bc) -eq 1 ]' {
	set-option -g pane-border-fg "$color_pane_border"
	set-option -g pane-active-border-fg "$color_pane_border_active"
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.9" | bc) -eq 1 ]' {
	set-option -g pane-border-style "fg=$color_pane_border"
	set-option -g pane-active-border-style "fg=$color_pane_border_active"
}

# Colorize messages in the command line
if-shell -b '[ $(echo "$TMUX_VERSION < 2.9" | bc) -eq 1 ]' {
	set-option -g message-fg "$color_message_fg"
	set-option -g message-bg "$color_message_bg"
	set-option -g message-attr bold
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.9" | bc) -eq 1 ]' {
	set-option -g message-style "fg=$color_message_fg,bg=$color_message_bg,bold"
}

# Status Bar {{{1
set-option -g status on			# turn the status bar on
set-option -g status-interval 60	# set update frequency (default 15 seconds)
set-option -g status-justify centre	# center window list for clarity

# visual notification of activity in other windows
set-window-option -g monitor-activity on
set-option -g visual-activity on

# set color for status bar
if-shell -b '[ $(echo "$TMUX_VERSION < 2.9" | bc) -eq 1 ]' {
	set-option -g status-fg "$color_status_fg"
	set-option -g status-bg "$color_status_bg"
	set-option -g status-attr none
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.9" | bc) -eq 1 ]' {
	set-option -g status-style "fg=$color_status_fg,bg=$color_status_bg,none"
}

# Set windows properties
if-shell -b '[ $(echo "$TMUX_VERSION < 2.9" | bc) -eq 1 ]' {
	set-window-option -g window-status-fg "$color_status_window"
	set-window-option -g window-status-bg "$color_status_bg"
	set-window-option -g window-status-attr dim
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.9" | bc) -eq 1 ]' {
	set-window-option -g window-status-style "fg=$color_status_window,bg=$color_status_bg,dim"
}
set-window-option -g window-status-format '#I:#W'

# Set current window properties
if-shell -b '[ $(echo "$TMUX_VERSION < 2.9" | bc) -eq 1 ]' {
	set-window-option -g window-status-current-fg "$color_status_fg"
	set-window-option -g window-status-current-bg "$color_status_bg"
	set-window-option -g window-status-current-attr bright
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.9" | bc) -eq 1 ]' {
	set-window-option -g window-status-current-style "fg=$color_status_fg,bg=$color_status_bg,bright"
}
set-window-option -g window-status-current-format '#I:#W'

if-shell -b '[ $(echo "$TMUX_VERSION < 2.9" | bc) -eq 1 ]' {
	set-window-option -g window-status-activity-fg "$color_status_window_activity"
	set-window-option -g window-status-activity-bg "$color_status_bg"
	set-window-option -g window-status-activity-attr bright
}
if-shell -b '[ $(echo "$TMUX_VERSION >= 2.9" | bc) -eq 1 ]' {
	set-window-option -g window-status-activity-style "fg=$color_status_window_activity,bg=$color_status_bg,bright"
}

set-option -g status-left '#[bold][#S]'
set-option -g status-right "#[bold]#[fg=$color_status_user]$USER#[fg=$color_status_at]@#[fg=$color_status_host]#h#[default] %a %I:%M %p"
